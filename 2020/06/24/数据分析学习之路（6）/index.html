<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>数据分析学习之路（6） | HappyBang</title><meta name="description" content="数据分析学习之路（6）科学计算库PandasPandas介绍Pandas 是基于NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。Pandas 纳入了大量库和一些标准的数据模型，提供了高效地操作大型数据集所需的工具。pandas提供了大量能使我们快速便捷地处理数据的函数和方法。 Series对象Pandas基于两种数据类型：series与dataframe。 Series是Pandas"><meta name="author" content="Bang Li"><meta name="copyright" content="Bang Li"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="数据分析学习之路（6）"><meta name="twitter:description" content="数据分析学习之路（6）科学计算库PandasPandas介绍Pandas 是基于NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。Pandas 纳入了大量库和一些标准的数据模型，提供了高效地操作大型数据集所需的工具。pandas提供了大量能使我们快速便捷地处理数据的函数和方法。 Series对象Pandas基于两种数据类型：series与dataframe。 Series是Pandas"><meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="og:type" content="article"><meta property="og:title" content="数据分析学习之路（6）"><meta property="og:url" content="http://yoursite.com/2020/06/24/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%EF%BC%886%EF%BC%89/"><meta property="og:site_name" content="HappyBang"><meta property="og:description" content="数据分析学习之路（6）科学计算库PandasPandas介绍Pandas 是基于NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。Pandas 纳入了大量库和一些标准的数据模型，提供了高效地操作大型数据集所需的工具。pandas提供了大量能使我们快速便捷地处理数据的函数和方法。 Series对象Pandas基于两种数据类型：series与dataframe。 Series是Pandas"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-06-24T10:31:14.000Z"><meta property="article:modified_time" content="2020-06-24T10:32:09.865Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2020/06/24/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%EF%BC%886%EF%BC%89/"><link rel="prev" title="小案例：电影数据分析" href="http://yoursite.com/2020/07/07/%E5%B0%8F%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%94%B5%E5%BD%B1%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"><link rel="next" title="数据分析学习之路（5）" href="http://yoursite.com/2020/06/24/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%EF%BC%885%EF%BC%89/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">24</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#数据分析学习之路（6）"><span class="toc-number">1.</span> <span class="toc-text">数据分析学习之路（6）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#科学计算库Pandas"><span class="toc-number">1.1.</span> <span class="toc-text">科学计算库Pandas</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pandas介绍"><span class="toc-number">1.1.1.</span> <span class="toc-text">Pandas介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Series对象"><span class="toc-number">1.1.2.</span> <span class="toc-text">Series对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DataFrame的创建"><span class="toc-number">1.1.3.</span> <span class="toc-text">DataFrame的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据合并"><span class="toc-number">1.1.4.</span> <span class="toc-text">数据合并</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多层索引"><span class="toc-number">1.1.5.</span> <span class="toc-text">多层索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#时间序列"><span class="toc-number">1.1.6.</span> <span class="toc-text">时间序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分组聚合"><span class="toc-number">1.1.7.</span> <span class="toc-text">分组聚合</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">HappyBang</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">数据分析学习之路（6）</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-06-24 18:31:14"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-06-24</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-06-24 18:32:09"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-06-24</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="数据分析学习之路（6）"><a href="#数据分析学习之路（6）" class="headerlink" title="数据分析学习之路（6）"></a>数据分析学习之路（6）</h1><h2 id="科学计算库Pandas"><a href="#科学计算库Pandas" class="headerlink" title="科学计算库Pandas"></a>科学计算库Pandas</h2><h3 id="Pandas介绍"><a href="#Pandas介绍" class="headerlink" title="Pandas介绍"></a>Pandas介绍</h3><p>Pandas 是基于NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。Pandas 纳入了大量库<br>和一些标准的数据模型，提供了高效地操作大型数据集所需的工具。pandas提供了大量能使我们快速<br>便捷地处理数据的函数和方法。</p>
<h3 id="Series对象"><a href="#Series对象" class="headerlink" title="Series对象"></a>Series对象</h3><p>Pandas基于两种数据类型：series与dataframe。</p>
<p>Series是Pandas中最基本的对象，Series类似一种一维数组。事实上，Series 基本上就是基于 NumPy<br>的数组对象来的。和 NumPy 的数组不同，Series 能为数据自定义标签，也就是索引（index），然后<br>通过索引来访问数组中的数据。</p>
<p>Dataframe是一个二维的表结构。Pandas的dataframe可以存储许多种不同的数据类型，并且每一个坐<br>标轴都有自己的标签。你可以把它想象成一个series的字典项。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series,DataFrame</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># 创建Series对象并省略索引</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">index 参数是可省略的，你可以选择不输入这个参数。</span></span><br><span class="line"><span class="string">如果不带 index 参数，Pandas 会自动用默认 index 进行索引，类似数组，索引值是 [0, ...,</span></span><br><span class="line"><span class="string">len(data) - 1]</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">sel =  Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">print(sel)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通常我们会自己创建索引</span></span><br><span class="line"><span class="comment"># sel = Series(data = [1,2,3,4], index = ['a','b','c','d'])</span></span><br><span class="line">sel =  Series(data = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], index = list(<span class="string">'abcd'</span>))</span><br><span class="line">print(sel)</span><br><span class="line"><span class="comment"># 获取内容</span></span><br><span class="line">print(sel.values)</span><br><span class="line"><span class="comment"># 获取索引</span></span><br><span class="line">print(sel.index)</span><br><span class="line"><span class="comment"># 获取索引和值对</span></span><br><span class="line">print(list(sel.iteritems()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将字典转换为Series</span></span><br><span class="line">dict=&#123;<span class="string">"red"</span>:<span class="number">100</span>,<span class="string">"black"</span>:<span class="number">400</span>,<span class="string">"green"</span>:<span class="number">300</span>,<span class="string">"pink"</span>:<span class="number">900</span>&#125;</span><br><span class="line">se3=Series(dict)</span><br><span class="line">print(se3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Series数据获取</span></span><br><span class="line">sel = Series(data = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], index = list(<span class="string">'abcd'</span>))</span><br><span class="line">print(sel)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Series对象同时支持位置和标签两种方式获取数据</span></span><br><span class="line">print(<span class="string">'索引下标'</span>,sel[<span class="string">'c'</span>])</span><br><span class="line">print(<span class="string">'位置下标'</span>,sel[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取不连续的数据</span></span><br><span class="line">print(<span class="string">'索引下标'</span>,sel[[<span class="string">'a'</span>,<span class="string">'c'</span>]])</span><br><span class="line">print(<span class="string">'位置下标'</span>,sel[[<span class="number">1</span>,<span class="number">3</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以使用切片或取数据</span></span><br><span class="line">print(<span class="string">'位置切片'</span>,sel[<span class="number">1</span>:<span class="number">3</span>])<span class="comment"># 左包含右不包含</span></span><br><span class="line">print(<span class="string">'索引切片'</span>,sel[<span class="string">'b'</span>:<span class="string">'d'</span>])<span class="comment"># 左右都包含</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新赋值索引的值</span></span><br><span class="line">sel.index = list(<span class="string">'dcba'</span>)</span><br><span class="line">print(sel)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ReIndex重新索引,会返回一个新的Series(调用reindex将会重新排序，缺失值则用NaN填补)</span></span><br><span class="line">print(sel.reindex([<span class="string">'b'</span>,<span class="string">'a'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Drop丢弃指定轴上的项</span></span><br><span class="line">se1=pd.Series(range(<span class="number">10</span>,<span class="number">15</span>))</span><br><span class="line">print(se1)</span><br><span class="line">print(se1.drop([<span class="number">2</span>,<span class="number">3</span>]))</span><br></pre></td></tr></table></figure>

<p>Series进行算数运算操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">对 Series 的算术运算都是基于 index 进行的。</span></span><br><span class="line"><span class="string">我们可以用加减乘除（+ - * /）这样的运算符对两个 Series 进行运算，</span></span><br><span class="line"><span class="string">Pandas 将会根据索引 index，对响应的数据进行计算，结果将会以浮点数的形式存储，以避免丢失精度。</span></span><br><span class="line"><span class="string">如果 Pandas 在两个 Series 里找不到相同的 index，对应的位置就返回一个空值 NaN</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">series1 = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],[<span class="string">'London'</span>,<span class="string">'HongKong'</span>,<span class="string">'Humbai'</span>,<span class="string">'lagos'</span>])</span><br><span class="line">series2 = pd.Series([<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">4</span>],[<span class="string">'London'</span>,<span class="string">'Accra'</span>,<span class="string">'lagos'</span>,<span class="string">'Delhi'</span>])</span><br><span class="line">print(series1-series2)</span><br><span class="line">print(series1+series2)</span><br><span class="line">print(series1*series2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同样也支持numpy的数组运算</span></span><br><span class="line">sel =  Series(data = [<span class="number">1</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">5</span>], index = list(<span class="string">'abcd'</span>))</span><br><span class="line">print(sel[sel&gt;<span class="number">3</span>]) <span class="comment"># 布尔数组过滤</span></span><br><span class="line">print(sel*<span class="number">2</span>) <span class="comment"># 标量乘法</span></span><br><span class="line">print(np.square(sel)) <span class="comment"># 可以直接加入到numpy的数学函数</span></span><br></pre></td></tr></table></figure>

<h3 id="DataFrame的创建"><a href="#DataFrame的创建" class="headerlink" title="DataFrame的创建"></a>DataFrame的创建</h3><p>​        DataFrame（数据表）是一种 2 维数据结构，数据以表格的形式存储，分成若干行和列。通过DataFrame，你能很方便地处理数据。常见的操作比如选取、替换行或列的数据，还能重组数据表、修改索引、多重筛选等。我们基本上可以把 DataFrame 理解成一组采用同样索引的 Series 的集合。调用DataFrame()可以将多种格式的数据转换为DataFrame对象，它的的三个参数data、index和columns分别为数据、行索引和列索引。</p>
<p>1、DataFrame的创建</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建DataFrame</span></span><br><span class="line"><span class="comment"># 使用二维数组</span></span><br><span class="line">df1 = DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">10</span>,(<span class="number">4</span>,<span class="number">4</span>)),index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],columns=</span><br><span class="line">[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 使用字典创建(行索引由index决定，列索引由字典的键决定)</span></span><br><span class="line">dict=&#123;</span><br><span class="line">  <span class="string">'Province'</span>: [<span class="string">'Guangdong'</span>, <span class="string">'Beijing'</span>, <span class="string">'Qinghai'</span>, <span class="string">'Fujian'</span>],</span><br><span class="line">  <span class="string">'pop'</span>: [<span class="number">1.3</span>, <span class="number">2.5</span>, <span class="number">1.1</span>, <span class="number">0.7</span>],</span><br><span class="line">  <span class="string">'year'</span>: [<span class="number">2018</span>, <span class="number">2018</span>, <span class="number">2018</span>, <span class="number">2018</span>]&#125;</span><br><span class="line">df2=pd.DataFrame(dict,index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">print(df2)</span><br><span class="line"><span class="comment"># 使用from_dict</span></span><br><span class="line">dict2=&#123;<span class="string">"a"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="string">"b"</span>:[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]&#125;</span><br><span class="line">df6=pd.DataFrame.from_dict(dict2)</span><br><span class="line">print(df6)</span><br><span class="line"><span class="comment">#索引相同的情况下，相同索引的值会相对应，缺少的值会添加NaN</span></span><br><span class="line">data = &#123;</span><br><span class="line">  <span class="string">'Name'</span>:pd.Series([<span class="string">'zs'</span>,<span class="string">'ls'</span>,<span class="string">'we'</span>],index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>]),</span><br><span class="line">  <span class="string">'Age'</span>:pd.Series([<span class="string">'10'</span>,<span class="string">'20'</span>,<span class="string">'30'</span>,<span class="string">'40'</span>],index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>]),</span><br><span class="line">  <span class="string">'country'</span>:pd.Series([<span class="string">'中国'</span>,<span class="string">'日本'</span>,<span class="string">'韩国'</span>],index=[<span class="string">'a'</span>,<span class="string">'c'</span>,<span class="string">'b'</span>])</span><br><span class="line">&#125;</span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line">print(df)</span><br><span class="line"><span class="comment"># to_dict()方法将DataFrame对象转换为字典</span></span><br><span class="line">dict = df.to_dict()</span><br><span class="line">print(dict)</span><br></pre></td></tr></table></figure>

<p>2、DataFrame对象常用属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series,DataFrame</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># dataframe常用属性</span></span><br><span class="line">df_dict = &#123;</span><br><span class="line"><span class="string">'name'</span>:[<span class="string">'James'</span>,<span class="string">'Curry'</span>,<span class="string">'Iversion'</span>],</span><br><span class="line"><span class="string">'age'</span>:[<span class="string">'18'</span>,<span class="string">'20'</span>,<span class="string">'19'</span>],</span><br><span class="line"><span class="string">'national'</span>:[<span class="string">'us'</span>,<span class="string">'China'</span>,<span class="string">'us'</span>]</span><br><span class="line">&#125;</span><br><span class="line">df = pd.DataFrame(data=df_dict,index=[<span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>])</span><br><span class="line">print(df)</span><br><span class="line"><span class="comment"># 获取行数和列数</span></span><br><span class="line">print(df.shape)</span><br><span class="line"><span class="comment"># # 获取行索引</span></span><br><span class="line">print(df.index.tolist())</span><br><span class="line"><span class="comment"># # 获取列索引</span></span><br><span class="line">print(df.columns.tolist())</span><br><span class="line"><span class="comment"># 获取数据的类型</span></span><br><span class="line">print(df.dtypes)</span><br><span class="line"><span class="comment"># 获取数据的维度</span></span><br><span class="line">print(df.ndim)</span><br><span class="line"><span class="comment"># values属性也会以二维ndarray的形式返回DataFrame的数据</span></span><br><span class="line">print(df.values)</span><br><span class="line"><span class="comment"># 展示df的概览</span></span><br><span class="line">print(df.info())</span><br><span class="line"><span class="comment"># 显示头几行,默认显示5行</span></span><br><span class="line">print(df.head(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># 显示后几行</span></span><br><span class="line">print(df.tail(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># 获取DataFrame的列</span></span><br><span class="line">print(df[<span class="string">'name'</span>])</span><br><span class="line"><span class="comment">#因为我们只获取一列，所以返回的就是一个 Series</span></span><br><span class="line">print(type(df[<span class="string">'name'</span>]))</span><br><span class="line"><span class="comment"># 如果获取多个列，那返回的就是一个 DataFrame 类型：</span></span><br><span class="line">print(df[[<span class="string">'name'</span>,<span class="string">'age'</span>]])</span><br><span class="line">print(type(df[[<span class="string">'name'</span>,<span class="string">'age'</span>]]))</span><br><span class="line"><span class="comment"># 获取一行</span></span><br><span class="line">print(df[<span class="number">0</span>:<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 取多行</span></span><br><span class="line">print(df[<span class="number">1</span>:<span class="number">3</span>])</span><br><span class="line"><span class="comment"># 取多行里面的某一列（不能进行多行多列的选择）</span></span><br><span class="line">print(df[<span class="number">1</span>:<span class="number">3</span>][[<span class="string">'name'</span>,<span class="string">'age'</span>]])</span><br><span class="line"><span class="comment"># 注意： df[]只能进行行选择，或列选择，不能同时多行多列选择。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">df.loc 通过标签索引行数据</span></span><br><span class="line"><span class="string">df.iloc 通过位置获取行数据</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># 获取某一行某一列的数据</span></span><br><span class="line">print(df.loc[<span class="string">'0'</span>,<span class="string">'name'</span>])</span><br><span class="line"><span class="comment"># 一行所有列</span></span><br><span class="line">print(df.loc[<span class="string">'0'</span>,:])</span><br><span class="line"><span class="comment"># 某一行多列的数据</span></span><br><span class="line">print(df.loc[<span class="string">'0'</span>,[<span class="string">'name'</span>,<span class="string">'age'</span>]])</span><br><span class="line"><span class="comment"># 选择间隔的多行多列</span></span><br><span class="line">print(df.loc[[<span class="string">'0'</span>,<span class="string">'2'</span>],[<span class="string">'name'</span>,<span class="string">'national'</span>]])</span><br><span class="line"><span class="comment"># 选择连续的多行和间隔的多列</span></span><br><span class="line">print(df.loc[<span class="string">'0'</span>:<span class="string">'2'</span>,[<span class="string">'name'</span>,<span class="string">'national'</span>]])</span><br><span class="line"><span class="comment"># 取一行</span></span><br><span class="line">print(df.iloc[<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 取连续多行</span></span><br><span class="line">print(df.iloc[<span class="number">0</span>:<span class="number">2</span>])</span><br><span class="line"><span class="comment"># 取间断的多行</span></span><br><span class="line">print(df.iloc[[<span class="number">0</span>,<span class="number">2</span>],:])</span><br><span class="line"><span class="comment"># 取某一列</span></span><br><span class="line">print(df.iloc[:,<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 某一个值</span></span><br><span class="line">print(df.iloc[<span class="number">1</span>,<span class="number">0</span>])</span><br><span class="line"><span class="comment"># 修改值</span></span><br><span class="line">df.iloc[<span class="number">0</span>,<span class="number">0</span>]=<span class="string">'panda'</span></span><br><span class="line">print(df)</span><br><span class="line"><span class="comment"># dataframe中的排序方法</span></span><br><span class="line">df = df.sort_values(by=<span class="string">'age'</span>,ascending=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># ascending=False ： 降序排列，默认是升序</span></span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>

<p>3、dataframe修改index、columns</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">9</span>).reshape(<span class="number">3</span>, <span class="number">3</span>), index = [<span class="string">'bj'</span>, <span class="string">'sh'</span>, <span class="string">'gz'</span>],</span><br><span class="line">columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 修改 df1 的 index</span></span><br><span class="line">print(df1.index) <span class="comment"># 可以打印出print的值，同时也可以为其赋值</span></span><br><span class="line">df1.index = [<span class="string">'beijing'</span>, <span class="string">'shanghai'</span>, <span class="string">'guangzhou'</span>]</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 自定义map函数（x是原有的行列值）</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_map</span><span class="params">(x)</span>:</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> x+<span class="string">'_ABC'</span></span><br><span class="line"><span class="comment"># inplace：布尔值，默认为False。指定是否返回新的DataFrame。如果为True，则在原df上修改，返</span></span><br><span class="line">回值为<span class="literal">None</span>。</span><br><span class="line">print(df1.rename(index=test_map, columns=test_map, inplace=<span class="literal">True</span>))</span><br><span class="line"><span class="comment"># 同时，rename 还可以传入字典，为某个 index 单独修改名称</span></span><br><span class="line">df3 = df1.rename(index=&#123;<span class="string">'bj'</span>:<span class="string">'beijing'</span>&#125;, columns = &#123;<span class="string">'a'</span>:<span class="string">'aa'</span>&#125;)</span><br><span class="line">print(df3)</span><br><span class="line"><span class="comment"># 列转化为索引</span></span><br><span class="line">df1=pd.DataFrame(&#123;<span class="string">'X'</span>:range(<span class="number">5</span>),<span class="string">'Y'</span>:range(<span class="number">5</span>),<span class="string">'S'</span>:list(<span class="string">"abcde"</span>),<span class="string">'Z'</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>]&#125;)</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 指定一列为索引 (drop=False 指定同时保留作为索引的列)</span></span><br><span class="line">result = df1.set_index(<span class="string">'S'</span>,drop=<span class="literal">False</span>)</span><br><span class="line">result.index.name=<span class="literal">None</span></span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># 行转为列索引</span></span><br><span class="line">result = df1.set_axis(df1.iloc[<span class="number">0</span>],axis=<span class="number">1</span>,inplace=<span class="literal">False</span>)</span><br><span class="line">result.columns.name=<span class="literal">None</span></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>4、添加数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加数据</span></span><br><span class="line">df1 = pd.DataFrame([[<span class="string">'Snow'</span>,<span class="string">'M'</span>,<span class="number">22</span>],[<span class="string">'Tyrion'</span>,<span class="string">'M'</span>,<span class="number">32</span>],[<span class="string">'Sansa'</span>,<span class="string">'F'</span>,<span class="number">18</span>],</span><br><span class="line">[<span class="string">'Arya'</span>,<span class="string">'F'</span>,<span class="number">14</span>]],columns=[<span class="string">'name'</span>,<span class="string">'gender'</span>,<span class="string">'age'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在数据框最后加上score一列</span></span><br><span class="line">df1[<span class="string">'score'</span>]=[<span class="number">80</span>,<span class="number">98</span>,<span class="number">67</span>,<span class="number">90</span>]  <span class="comment"># 增加列的元素个数要跟原数据列的个数一样</span></span><br><span class="line">print(df1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在具体某个位置插入一列可以用insert的方法</span></span><br><span class="line"><span class="comment"># 语法格式：列表.insert(index, obj)</span></span><br><span class="line"><span class="comment"># index ---&gt;对象 obj 需要插入的索引位置。</span></span><br><span class="line"><span class="comment"># obj ---&gt; 要插入列表中的对象（列名）</span></span><br><span class="line">col_name=df1.columns.tolist()          <span class="comment"># 将数据框的列名全部提取出来存放在列表里</span></span><br><span class="line">col_name.insert(<span class="number">2</span>,<span class="string">'city'</span>)            <span class="comment"># 在列索引为2的位置插入一列,列名为:city，刚插入时不会有值，整列都是NaN</span></span><br><span class="line">df1=df1.reindex(columns=col_name)        <span class="comment"># DataFrame.reindex() 对原行/列索引重新构建索引值</span></span><br><span class="line">print(df1)</span><br><span class="line">df1[<span class="string">'city'</span>]=[<span class="string">'北京'</span>,<span class="string">'山西'</span>,<span class="string">'湖北'</span>,<span class="string">'澳门'</span>]  <span class="comment"># 给city列赋值</span></span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># df中的insert,插入一列</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">df.insert(iloc,column,value)</span></span><br><span class="line"><span class="string">iloc:要插入的位置</span></span><br><span class="line"><span class="string">colunm:列名</span></span><br><span class="line"><span class="string">value:值</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">df1.insert(<span class="number">2</span>,<span class="string">'score'</span>,[<span class="number">80</span>,<span class="number">98</span>,<span class="number">67</span>,<span class="number">90</span>])</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 插入一行</span></span><br><span class="line">row=[<span class="string">'111'</span>,<span class="string">'222'</span>,<span class="string">'333'</span>]</span><br><span class="line">df1.iloc[<span class="number">1</span>]=row</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 增加数据</span></span><br><span class="line">df1 = pd.DataFrame([[<span class="string">'Snow'</span>,<span class="string">'M'</span>,<span class="number">22</span>],[<span class="string">'Tyrion'</span>,<span class="string">'M'</span>,<span class="number">32</span>],[<span class="string">'Sansa'</span>,<span class="string">'F'</span>,<span class="number">18</span>],</span><br><span class="line">[<span class="string">'Arya'</span>,<span class="string">'F'</span>,<span class="number">14</span>]],</span><br><span class="line">         columns=[<span class="string">'name'</span>,<span class="string">'gender'</span>,<span class="string">'age'</span>])</span><br><span class="line"><span class="comment"># 先创建一个DataFrame，用来增加进数据框的最后一行</span></span><br><span class="line">new=pd.DataFrame(&#123;<span class="string">'name'</span>:<span class="string">'lisa'</span>,</span><br><span class="line">         <span class="string">'gender'</span>:<span class="string">'F'</span>,</span><br><span class="line">         <span class="string">'age'</span>:<span class="number">19</span></span><br><span class="line">        &#125;,index=[<span class="number">0</span>])</span><br><span class="line">print(new)</span><br><span class="line"><span class="comment"># print("-------在原数据框df1最后一行新增一行，用append方法------------")</span></span><br><span class="line">df1=df1.append(new,ignore_index=<span class="literal">True</span>)  <span class="comment"># ignore_index=False,表示不按原来的索引，从0</span></span><br><span class="line">开始自动递增</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 合并</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">objs:合并对象</span></span><br><span class="line"><span class="string">axis:合并方式，默认0表示按列合并，1表示按行合并</span></span><br><span class="line"><span class="string">ignore_index:是否忽略索引</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">6</span>).reshape(<span class="number">3</span>,<span class="number">2</span>),columns=[<span class="string">'four'</span>,<span class="string">'five'</span>])</span><br><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">6</span>).reshape(<span class="number">2</span>,<span class="number">3</span>),columns=[<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'three'</span>])</span><br><span class="line">print(df2)</span><br><span class="line"><span class="comment"># # 按行合并</span></span><br><span class="line">result = pd.concat([df1,df2],axis=<span class="number">1</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># # 按列合并</span></span><br><span class="line">result = pd.concat([df1,df2],axis=<span class="number">0</span>,ignore_index=<span class="literal">True</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># DataFrame的删除</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">lables：要删除数据的标签</span></span><br><span class="line"><span class="string">axis：0表示删除行，1表示删除列，默认0</span></span><br><span class="line"><span class="string">inplace:是否在当前df中执行此操作</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">9</span>).reshape(<span class="number">3</span>,<span class="number">3</span>),columns=[<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'three'</span>])</span><br><span class="line">print(df2)</span><br><span class="line">df3=df2.drop([<span class="string">'one'</span>],axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># df3=df2.drop([0,1],axis=0, inplace=False)</span></span><br><span class="line">print(df2)</span><br><span class="line">print(df3)</span><br></pre></td></tr></table></figure>

<p>4、数据处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NaN</span><br><span class="line"><span class="comment"># 2.1通过**dropna()**滤除缺失数据：</span></span><br><span class="line">se=pd.Series([<span class="number">4</span>,NaN,<span class="number">8</span>,NaN,<span class="number">5</span>])</span><br><span class="line"><span class="comment"># print(se)</span></span><br><span class="line"><span class="comment"># print(se.dropna())</span></span><br><span class="line"><span class="comment"># print(se.notnull())</span></span><br><span class="line"><span class="comment"># print(se.isnull())</span></span><br><span class="line"><span class="comment"># # 通过布尔序列也能滤除：</span></span><br><span class="line"><span class="comment"># print(se[se.notnull()])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.2 处理DataFrame对象</span></span><br><span class="line">df1=pd.DataFrame([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[NaN,NaN,<span class="number">2</span>],[NaN,NaN,NaN],[<span class="number">8</span>,<span class="number">8</span>,NaN]])</span><br><span class="line"><span class="comment"># print(df1)</span></span><br><span class="line"><span class="comment"># 默认滤除所有包含NaN：</span></span><br><span class="line"><span class="comment"># print(df1.dropna())</span></span><br><span class="line"><span class="comment"># 传入how=‘all’滤除全为NaN的行：</span></span><br><span class="line"><span class="comment"># print(df1.dropna(how='all')) # 默认情况下是how='any'，只要有nan就删除</span></span><br><span class="line"><span class="comment"># 传入axis=1滤除列：</span></span><br><span class="line"><span class="comment"># print(df1.dropna(axis=1,how="all"))</span></span><br><span class="line"><span class="comment">#传入thresh=n保留至少有n个非NaN数据的行：</span></span><br><span class="line"><span class="comment"># print(df1.dropna(thresh=1))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.3 填充缺失数据</span></span><br><span class="line">df1=pd.DataFrame([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[NaN,NaN,<span class="number">2</span>],[NaN,NaN,NaN],[<span class="number">8</span>,<span class="number">8</span>,NaN]])</span><br><span class="line"><span class="comment"># print(df1)</span></span><br><span class="line"><span class="comment"># 用常数填充fillna</span></span><br><span class="line"><span class="comment"># print(df1.fillna(0))</span></span><br><span class="line"><span class="comment">#传入inplace=True直接修改原对象：</span></span><br><span class="line"><span class="comment"># df1.fillna(0,inplace=True)</span></span><br><span class="line"><span class="comment"># print(df1)</span></span><br><span class="line"><span class="comment"># 通过字典填充不同的常数</span></span><br><span class="line"><span class="comment"># print(df1.fillna(&#123;0:10,1:20,2:30&#125;))</span></span><br><span class="line"><span class="comment"># 填充平均值</span></span><br><span class="line">print(df1.fillna(df1.mean()))</span><br><span class="line"><span class="comment"># 如果只填充一列</span></span><br><span class="line">print(df1.iloc[:,<span class="number">1</span>].fillna(<span class="number">5</span>,inplace = <span class="literal">True</span>))</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 传入method=” “改变插值方式：</span></span><br><span class="line">df2=pd.DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">10</span>,(<span class="number">5</span>,<span class="number">5</span>)))</span><br><span class="line">df2.iloc[<span class="number">1</span>:<span class="number">4</span>,<span class="number">3</span>]=NaN</span><br><span class="line">df2.iloc[<span class="number">2</span>:<span class="number">4</span>,<span class="number">4</span>]=NaN</span><br><span class="line"><span class="comment"># print(df2)</span></span><br><span class="line"><span class="comment">#用前面的值来填充ffill  用后面的值来填充bfill</span></span><br><span class="line"><span class="comment"># print(df2.fillna(method='ffill'))</span></span><br><span class="line"><span class="comment"># 传入limit=” “限制填充行数：</span></span><br><span class="line"><span class="comment"># print(df2.fillna(method='bfill',limit=1))</span></span><br><span class="line"><span class="comment"># 传入axis=” “修改填充方向：</span></span><br><span class="line"><span class="comment"># print(df2.fillna(method="ffill",limit=1,axis=1))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.4 移除重复数据</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">DataFrame中经常会出现重复行，利用duplicated()函数返回每一行判断是否重复的结果（重复则为</span></span><br><span class="line"><span class="string">True)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">df1=pd.DataFrame(&#123;<span class="string">'A'</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>],<span class="string">'B'</span>:list(<span class="string">"aabbbca"</span>)&#125;)</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 判断每一行是否重复(结果是bool值，TRUE代表重复的)</span></span><br><span class="line"><span class="comment"># print(df1.duplicated())</span></span><br><span class="line"><span class="comment"># 去除全部的重复行</span></span><br><span class="line"><span class="comment"># print(df1.drop_duplicates())</span></span><br><span class="line"><span class="comment"># # 指定列去除重复行</span></span><br><span class="line"><span class="comment"># print(df1.drop_duplicates(['A']))</span></span><br><span class="line"><span class="comment"># 保留重复行中的最后一行</span></span><br><span class="line"><span class="comment"># print(df1.drop_duplicates(['A'],keep='last'))</span></span><br><span class="line"><span class="comment"># 去除重复的同时改变DataFrame对象</span></span><br><span class="line"><span class="comment"># df1.drop_duplicates(['A','B'],inplace=True)</span></span><br><span class="line"><span class="comment"># print(df1)</span></span><br></pre></td></tr></table></figure>

<h3 id="数据合并"><a href="#数据合并" class="headerlink" title="数据合并"></a>数据合并</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用join合并，着重关注的是行的合并</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df3=pd.DataFrame(&#123;<span class="string">'Red'</span>:[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>],<span class="string">'Green'</span>:[<span class="number">5</span>,<span class="number">0</span>,<span class="number">3</span>]&#125;,index=list(<span class="string">'abc'</span>))</span><br><span class="line">df4=pd.DataFrame(&#123;<span class="string">'Blue'</span>:[<span class="number">1</span>,<span class="number">9</span>,<span class="number">8</span>],<span class="string">'Yellow'</span>:[<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>]&#125;,index=list(<span class="string">'cde'</span>))</span><br><span class="line">print(df3)</span><br><span class="line">print(df4)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单合并（默认是left左连接,以左侧df3为基础）</span></span><br><span class="line">df3.join(df4,how=<span class="string">'left'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 右链接</span></span><br><span class="line">df3.join(df4,how=<span class="string">'right'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 外链接</span></span><br><span class="line">df3.join(df4,how=<span class="string">'outer'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并多个DataFrame对象</span></span><br><span class="line"><span class="comment"># df5=pd.DataFrame(&#123;'Brown':[3,4,5],'White':[1,1,2]&#125;,index=list('aed'))</span></span><br><span class="line"><span class="comment"># df3.join([df4,df5])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认下是根据左右对象中出现同名的列作为连接的键，且连接方式是how=’inner’</span></span><br><span class="line"><span class="comment"># print(pd.merge(df1,df2))# 返回匹配的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定列名合并</span></span><br><span class="line">pd.merge(df1,df2,on=<span class="string">'名字'</span>,suffixes=[<span class="string">'_1'</span>,<span class="string">'_2'</span>])<span class="comment"># 返回匹配的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接方式，根据左侧为准</span></span><br><span class="line">pd.merge(df1,df2,how=<span class="string">'left'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据左侧为准</span></span><br><span class="line">pd.merge(df1,df2,how=<span class="string">'right'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有</span></span><br><span class="line"><span class="comment"># pd.merge(df1,df2,how='outer')</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据多个键进行连接</span></span><br><span class="line">pd.merge(df1,df2,on=[<span class="string">'职称'</span>,<span class="string">'名字'</span>])</span><br></pre></td></tr></table></figure>

<p>拓展：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 轴向连接-Concat</span></span><br><span class="line"><span class="comment"># 1. Series对象的连接</span></span><br><span class="line"><span class="comment"># s1=pd.Series([1,2],index=list('ab'))</span></span><br><span class="line"><span class="comment"># s2=pd.Series([3,4,5],index=list('bde'))</span></span><br><span class="line"><span class="comment"># print(s1)</span></span><br><span class="line"><span class="comment"># print(s2)</span></span><br><span class="line"><span class="comment"># pd.concat([s1,s2])</span></span><br><span class="line"><span class="comment">#横向连接</span></span><br><span class="line"><span class="comment"># pd.concat([s1,s2],axis=1)</span></span><br><span class="line"><span class="comment"># 用内连接求交集(连接方式，共有’inner’,’outer’)</span></span><br><span class="line"><span class="comment"># pd.concat([s1,s2],axis=1,join='inner')</span></span><br><span class="line"><span class="comment"># 指定部分索引进行连接</span></span><br><span class="line"><span class="comment"># pd.concat([s1,s2],axis=1,join_axes=[list('abc')])</span></span><br><span class="line"><span class="comment"># 创建层次化索引</span></span><br><span class="line"><span class="comment"># pd.concat([s1,s2],keys=['A','B'])</span></span><br><span class="line"><span class="comment">#当纵向连接时keys为列名</span></span><br><span class="line"><span class="comment"># pd.concat([s1,s2],keys=['A','D'],axis=1)</span></span><br><span class="line"><span class="comment"># 2. DataFrame对象的连接</span></span><br><span class="line">df3=pd.DataFrame(&#123;<span class="string">'Red'</span>:[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>],<span class="string">'Green'</span>:[<span class="number">5</span>,<span class="number">0</span>,<span class="number">3</span>]&#125;,index=list(<span class="string">'abd'</span>))</span><br><span class="line">df4=pd.DataFrame(&#123;<span class="string">'Blue'</span>:[<span class="number">1</span>,<span class="number">9</span>],<span class="string">'Yellow'</span>:[<span class="number">6</span>,<span class="number">6</span>]&#125;,index=list(<span class="string">'ce'</span>))</span><br><span class="line">print(df3)</span><br><span class="line">print(df4)</span><br><span class="line"><span class="comment"># pd.concat([df3,df4])</span></span><br><span class="line"><span class="comment"># pd.concat([df3,df4],axis=1,keys=['A','B'])</span></span><br><span class="line"><span class="comment"># 用字典的方式连接同样可以创建层次化列索引</span></span><br><span class="line"><span class="comment"># pd.concat(&#123;'A':df3,'B':df4&#125;,axis=1)</span></span><br></pre></td></tr></table></figure>

<h3 id="多层索引"><a href="#多层索引" class="headerlink" title="多层索引"></a>多层索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series,DataFrame</span><br><span class="line"><span class="comment"># 1. Series也可以创建多层索引</span></span><br><span class="line">s = Series(np.random.randint(<span class="number">0</span>,<span class="number">150</span>,size=<span class="number">6</span>),index=list(<span class="string">'abcdef'</span>))</span><br><span class="line">print(s)</span><br><span class="line">s = Series(np.random.randint(<span class="number">0</span>,<span class="number">150</span>,size=<span class="number">6</span>),</span><br><span class="line">index=[[<span class="string">'a'</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'c'</span>],[<span class="string">'期中'</span>,<span class="string">'期末'</span>,<span class="string">'期中'</span>,<span class="string">'期末'</span>,<span class="string">'期中'</span>,<span class="string">'期末'</span>]])</span><br><span class="line">print(s)</span><br><span class="line"><span class="comment"># DataFrame创建多层索引</span></span><br><span class="line">df1 = DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">150</span>,size=(<span class="number">6</span>,<span class="number">4</span>)),</span><br><span class="line">columns = [<span class="string">'zs'</span>,<span class="string">'ls'</span>,<span class="string">'ww'</span>,<span class="string">'zl'</span>],</span><br><span class="line">index = [[<span class="string">'python'</span>,<span class="string">'python'</span>,<span class="string">'math'</span>,<span class="string">'math'</span>,<span class="string">'En'</span>,<span class="string">'En'</span>],[<span class="string">'期中'</span>,<span class="string">'期末'</span>,<span class="string">'期中'</span>,<span class="string">'期末'</span>,<span class="string">'期中'</span>,<span class="string">'期末'</span>]])</span><br><span class="line">print(df1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 特定结构</span></span><br><span class="line">class1=[<span class="string">'python'</span>,<span class="string">'python'</span>,<span class="string">'math'</span>,<span class="string">'math'</span>,<span class="string">'En'</span>,<span class="string">'En'</span>]</span><br><span class="line">class2=[<span class="string">'期中'</span>,<span class="string">'期末'</span>,<span class="string">'期中'</span>,<span class="string">'期末'</span>,<span class="string">'期中'</span>,<span class="string">'期末'</span>]</span><br><span class="line">m_index2=pd.MultiIndex.from_arrays([class1,class2])</span><br><span class="line">df2=DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">150</span>,(<span class="number">6</span>,<span class="number">4</span>)),index=m_index2)</span><br><span class="line">print(df2)</span><br><span class="line">class1=[<span class="string">'期中'</span>,<span class="string">'期中'</span>,<span class="string">'期中'</span>,<span class="string">'期末'</span>,<span class="string">'期末'</span>,<span class="string">'期末'</span>]</span><br><span class="line">class2=[<span class="string">'python'</span>,<span class="string">'math'</span>,<span class="string">'En'</span>,<span class="string">'python'</span>,<span class="string">'math'</span>,<span class="string">'En'</span>]</span><br><span class="line">m_index2=pd.MultiIndex.from_arrays([class1,class2])</span><br><span class="line">df2=DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">150</span>,(<span class="number">6</span>,<span class="number">4</span>)),index=m_index2)</span><br><span class="line">print(df2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. product构造</span></span><br><span class="line">class1=[<span class="string">'python'</span>,<span class="string">'math'</span>,<span class="string">'En'</span>]</span><br><span class="line">class2=[<span class="string">'期中'</span>,<span class="string">'期末'</span>]</span><br><span class="line">m_index2=pd.MultiIndex.from_product([class1,class2])</span><br><span class="line">df2=DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">150</span>,(<span class="number">6</span>,<span class="number">4</span>)),index=m_index2)</span><br><span class="line">print(df2)</span><br></pre></td></tr></table></figure>

<p>多层索引对象的索引：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#多层索引对象的索引操作</span></span><br><span class="line"><span class="comment"># series</span></span><br><span class="line">s = Series(np.random.randint(<span class="number">0</span>,<span class="number">150</span>,size=<span class="number">6</span>),</span><br><span class="line">index=[[<span class="string">'a'</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'c'</span>],[<span class="string">'期中'</span>,<span class="string">'期末'</span>,<span class="string">'期中'</span>,<span class="string">'期末'</span>,<span class="string">'期中'</span>,<span class="string">'期末'</span>]])</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取一个第一级索引</span></span><br><span class="line"><span class="comment"># print(s['a'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取多个第一级索引</span></span><br><span class="line"><span class="comment"># print(s[['a','b']])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据索引获取值</span></span><br><span class="line"><span class="comment"># print(s['a','期末'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># loc方法取值</span></span><br><span class="line"><span class="comment"># print(s.loc['a'])</span></span><br><span class="line"><span class="comment"># print(s.loc[['a','b']])</span></span><br><span class="line"><span class="comment"># print(s.loc['a','期末'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># iloc方法取值(iloc计算的事最内层索引)</span></span><br><span class="line"><span class="comment"># print(s.iloc[1])</span></span><br><span class="line"><span class="comment"># print(s.iloc[1:4])</span></span><br><span class="line"><span class="comment"># dataframe</span></span><br><span class="line">class1=[<span class="string">'python'</span>,<span class="string">'math'</span>,<span class="string">'En'</span>]</span><br><span class="line">class2=[<span class="string">'期中'</span>,<span class="string">'期末'</span>]</span><br><span class="line">m_index2=pd.MultiIndex.from_product([class1,class2])</span><br><span class="line">df2=DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">150</span>,(<span class="number">6</span>,<span class="number">4</span>)),index=m_index2)</span><br><span class="line">print(df2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取列</span></span><br><span class="line"><span class="comment"># print(df2[0])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一级索引</span></span><br><span class="line"><span class="comment"># print(df2.loc['python'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个一级索引</span></span><br><span class="line"><span class="comment"># print(df2.loc[['python','math']])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取一行</span></span><br><span class="line"><span class="comment"># print(df2.loc['python','期末'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取一值</span></span><br><span class="line"><span class="comment"># print(df2.loc['python','期末'][0])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># iloc是只取最内层的索引的</span></span><br><span class="line"><span class="comment">#print(df2.iloc[0])</span></span><br></pre></td></tr></table></figure>

<h3 id="时间序列"><a href="#时间序列" class="headerlink" title="时间序列"></a>时间序列</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># 1. 生成一段时间范围</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">该函数主要用于生成一个固定频率的时间索引，在调用构造方法时，必须指定start、end、periods中的两</span></span><br><span class="line"><span class="string">个参数值，否则报错。</span></span><br><span class="line"><span class="string">时间序列频率：</span></span><br><span class="line"><span class="string"> D    日历日的每天</span></span><br><span class="line"><span class="string"> B    工作日的每天</span></span><br><span class="line"><span class="string"> H    每小时</span></span><br><span class="line"><span class="string"> T或min  每分钟</span></span><br><span class="line"><span class="string"> S    每秒</span></span><br><span class="line"><span class="string"> L或ms  每毫秒</span></span><br><span class="line"><span class="string"> U    每微秒</span></span><br><span class="line"><span class="string"> M    日历日的月底日期</span></span><br><span class="line"><span class="string"> BM    工作日的月底日期</span></span><br><span class="line"><span class="string"> MS    日历日的月初日期</span></span><br><span class="line"><span class="string"> BMS   工作日的月初日期</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">date = pd.date_range(start=<span class="string">'20190501'</span>,end=<span class="string">'20190530'</span>)</span><br><span class="line">print(date)</span><br><span class="line"><span class="comment"># freq：日期偏移量，取值为string, 默认为'D'， freq='1h30min' freq='10D'</span></span><br><span class="line"><span class="comment"># periods：固定时期，取值为整数或None</span></span><br><span class="line">date = pd.date_range(start=<span class="string">'20190501'</span>,periods=<span class="number">10</span>,freq=<span class="string">'10D'</span>)</span><br><span class="line">print(date)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">根据closed参数选择是否包含开始和结束时间closed=None，left包含开始时间，不包含结束时间，</span></span><br><span class="line"><span class="string">right与之相反。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">data_time =pd.date_range(start=<span class="string">'2019-01-09'</span>,end=<span class="string">'2019-01-14'</span>,closed=<span class="string">'left'</span>)</span><br><span class="line">print(data_time)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 时间序列在dataFrame中的作用</span></span><br><span class="line"><span class="comment"># 可以将时间作为索引</span></span><br><span class="line">index = pd.date_range(start=<span class="string">'20190101'</span>,periods=<span class="number">10</span>)</span><br><span class="line">df = pd.Series(np.random.randint(<span class="number">0</span>,<span class="number">10</span>,size = <span class="number">10</span>),index=index)</span><br><span class="line">print(df)</span><br><span class="line"><span class="comment"># truncate这个函数将before指定日期之前的值全部过滤出去,after指定日期之前的值全部过滤出去.</span></span><br><span class="line">after = df.truncate(after=<span class="string">'2019-01-8'</span>)</span><br><span class="line">print(after)</span><br><span class="line">long_ts = pd.Series(np.random.randn(<span class="number">1000</span>),index=pd.date_range(<span class="string">'1/1/2019'</span>,periods=<span class="number">1000</span>))</span><br><span class="line"><span class="comment"># print(long_ts)</span></span><br><span class="line"><span class="comment"># 根据年份获取</span></span><br><span class="line"><span class="comment"># result = long_ts['2020']</span></span><br><span class="line"><span class="comment"># print(result)</span></span><br><span class="line"><span class="comment"># 年份和日期获取</span></span><br><span class="line"><span class="comment"># result = long_ts['2020-05']</span></span><br><span class="line"><span class="comment"># print(result)</span></span><br><span class="line"><span class="comment"># 使用切片</span></span><br><span class="line"><span class="comment"># result = long_ts['2020-05-01':'2020-05-06']</span></span><br><span class="line"><span class="comment"># print(result)</span></span><br><span class="line"><span class="comment"># 通过between_time()返回位于指定时间段的数据集</span></span><br><span class="line"><span class="comment"># index=pd.date_range("2018-03-17","2018-03-30",freq="2H")</span></span><br><span class="line"><span class="comment"># ts = pd.Series(np.random.randn(157),index=index)</span></span><br><span class="line"><span class="comment"># print(ts.between_time("7:00","17:00"))</span></span><br><span class="line"><span class="comment"># 这些操作也都适用于dataframe</span></span><br><span class="line"><span class="comment"># index=pd.date_range('1/1/2019',periods=100)</span></span><br><span class="line"><span class="comment"># df = pd.DataFrame(np.random.randn(100,4),index=index)</span></span><br><span class="line"><span class="comment"># print(df.loc['2019-04'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 移位日期</span></span><br><span class="line">ts = pd.Series(np.random.randn(<span class="number">10</span>),index=pd.date_range(<span class="string">'1/1/2019'</span>,periods=<span class="number">10</span>))</span><br><span class="line">print(ts)</span><br><span class="line"><span class="comment"># 移动数据，索引不变，默认由NaN填充</span></span><br><span class="line"><span class="comment"># periods: 移动的位数 负数是向上移动</span></span><br><span class="line"><span class="comment"># fill_value: 移动后填充数据</span></span><br><span class="line"><span class="comment"># freq： 日期偏移量</span></span><br><span class="line">ts.shift(periods=<span class="number">2</span>,fill_value=<span class="number">100</span>，freq=<span class="string">'D'</span>)</span><br><span class="line"><span class="comment"># 通过tshift()将索引移动指定的时间：</span></span><br><span class="line">ts.tshift(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 将时间戳转化成时间根式</span></span><br><span class="line">pd.to_datetime(<span class="number">1554970740000</span>,unit=<span class="string">'ms'</span>)</span><br><span class="line"><span class="comment"># utc是协调世界时,时区是以UTC的偏移量的形式表示的,但是注意设置utc=True,是让pandas对象具有时</span></span><br><span class="line">区性质,对于一列进行转换的,会造成转换错误</span><br><span class="line"><span class="comment"># unit='ms' 设置粒度是到毫秒级别的</span></span><br><span class="line"><span class="comment"># 时区名字</span></span><br><span class="line"><span class="comment"># import pytz</span></span><br><span class="line"><span class="comment"># print(pytz.common_timezones)</span></span><br><span class="line"><span class="number">2019</span><span class="number">-5</span><span class="number">-1</span></span><br><span class="line">pd.to_datetime(<span class="number">1554970740000</span>,unit=<span class="string">'ms'</span>).tz_localize(<span class="string">'UTC'</span>).tz_convert(<span class="string">'Asia/Shanghai'</span>)</span><br><span class="line"><span class="comment"># 处理一列</span></span><br><span class="line">df = pd.DataFrame([<span class="number">1554970740000</span>, <span class="number">1554970800000</span>, <span class="number">1554970860000</span>],columns =</span><br><span class="line">[<span class="string">'time_stamp'</span>])</span><br><span class="line">pd.to_datetime(df[<span class="string">'time_stamp'</span>],unit=<span class="string">'ms'</span>).dt.tz_localize(<span class="string">'UTC'</span>).dt.tz_convert(<span class="string">'</span></span><br><span class="line"><span class="string">Asia/Shanghai'</span>)<span class="comment">#先赋予标准时区,再转换到东八区</span></span><br><span class="line"><span class="comment"># 处理中文</span></span><br><span class="line">pd.to_datetime(<span class="string">'2019年10月10日'</span>,format=<span class="string">'%Y年%m月%d日'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="分组聚合"><a href="#分组聚合" class="headerlink" title="分组聚合"></a>分组聚合</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分组</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df=pd.DataFrame(&#123;</span><br><span class="line">  <span class="string">'name'</span>:[<span class="string">'BOSS'</span>,<span class="string">'Lilei'</span>,<span class="string">'Lilei'</span>,<span class="string">'Han'</span>,<span class="string">'BOSS'</span>,<span class="string">'BOSS'</span>,<span class="string">'Han'</span>,<span class="string">'BOSS'</span>],</span><br><span class="line">  <span class="string">'Year'</span>:[<span class="number">2016</span>,<span class="number">2016</span>,<span class="number">2016</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2017</span>,<span class="number">2017</span>,<span class="number">2017</span>],</span><br><span class="line">  <span class="string">'Salary'</span>:[<span class="number">999999</span>,<span class="number">20000</span>,<span class="number">25000</span>,<span class="number">3000</span>,<span class="number">9999999</span>,<span class="number">999999</span>,<span class="number">3500</span>,<span class="number">999999</span>],</span><br><span class="line">  <span class="string">'Bonus'</span>:[<span class="number">100000</span>,<span class="number">20000</span>,<span class="number">20000</span>,<span class="number">5000</span>,<span class="number">200000</span>,<span class="number">300000</span>,<span class="number">3000</span>,<span class="number">400000</span>]</span><br><span class="line"> &#125;)</span><br><span class="line"><span class="comment"># print(df)</span></span><br><span class="line"><span class="comment"># 根据name这一列进行分组</span></span><br><span class="line"><span class="comment"># group_by_name=df.groupby('name')</span></span><br><span class="line"><span class="comment"># print(type(group_by_name))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看分组</span></span><br><span class="line"><span class="comment"># print(group_by_name.groups)</span></span><br><span class="line"><span class="comment"># 分组后的数量</span></span><br><span class="line"><span class="comment"># print(group_by_name.count())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以选择分组</span></span><br><span class="line"><span class="comment"># print(group_by_name.get_group('BOSS'))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照某一列进行分组, 将name这一列作为分组的键，对year进行分组</span></span><br><span class="line"><span class="comment"># group_by_name=df['Year'].groupby(df['name'])</span></span><br><span class="line"><span class="comment"># print(group_by_name.count())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照多列进行分组</span></span><br><span class="line"><span class="comment"># group_by_name_year=df.groupby(['name','Year'])</span></span><br><span class="line"><span class="comment"># for name,group in group_by_name_year:</span></span><br><span class="line"><span class="comment">#   print(name)# 组的名字</span></span><br><span class="line"><span class="comment">#   print(group)# 组具体内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以选择分组</span></span><br><span class="line"><span class="comment"># print(group_by_name_year.get_group(('BOSS',2016)))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将某列数据按数据值分成不同范围段进行分组（groupby）运算</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">'Age'</span>: np.random.randint(<span class="number">20</span>, <span class="number">70</span>, <span class="number">100</span>),</span><br><span class="line">          <span class="string">'Sex'</span>: np.random.choice([<span class="string">'M'</span>, <span class="string">'F'</span>], <span class="number">100</span>),</span><br><span class="line">         &#125;)</span><br><span class="line">age_groups = pd.cut(df[<span class="string">'Age'</span>], bins=[<span class="number">19</span>,<span class="number">40</span>,<span class="number">65</span>,<span class="number">100</span>])</span><br><span class="line"><span class="comment"># print(age_groups)</span></span><br><span class="line">print(df.groupby(age_groups).count())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按‘Age’分组范围和性别（sex）进行制作交叉表</span></span><br><span class="line">pd.crosstab(age_groups, df[<span class="string">'Sex'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">## 聚合</span></span><br><span class="line"><span class="string">'''聚合函数</span></span><br><span class="line"><span class="string">mean  计算分组平均值</span></span><br><span class="line"><span class="string">count 分组中非NA值的数量</span></span><br><span class="line"><span class="string">sum  非NA值的和</span></span><br><span class="line"><span class="string">median 非NA值的算术中位数</span></span><br><span class="line"><span class="string">std  标准差</span></span><br><span class="line"><span class="string">var  方差</span></span><br><span class="line"><span class="string">min  非NA值的最小值</span></span><br><span class="line"><span class="string">max  非NA值的最大值</span></span><br><span class="line"><span class="string">prod  非NA值的积</span></span><br><span class="line"><span class="string">first 第一个非NA值</span></span><br><span class="line"><span class="string">last  最后一个非NA值</span></span><br><span class="line"><span class="string">mad  平均绝对偏差</span></span><br><span class="line"><span class="string">mode 模</span></span><br><span class="line"><span class="string">abs  绝对值</span></span><br><span class="line"><span class="string">sem 平均值的标准误差</span></span><br><span class="line"><span class="string">skew 样品偏斜度（三阶矩）</span></span><br><span class="line"><span class="string">kurt 样品峰度（四阶矩）</span></span><br><span class="line"><span class="string">quantile 样本分位数（百分位上的值）</span></span><br><span class="line"><span class="string">cumsum 累积总和</span></span><br><span class="line"><span class="string">cumprod 累积乘积</span></span><br><span class="line"><span class="string">cummax 累积最大值</span></span><br><span class="line"><span class="string">cummin 累积最小值</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">df1=pd.DataFrame(&#123;<span class="string">'Data1'</span>:np.random.randint(<span class="number">0</span>,<span class="number">10</span>,<span class="number">5</span>),</span><br><span class="line">         <span class="string">'Data2'</span>:np.random.randint(<span class="number">10</span>,<span class="number">20</span>,<span class="number">5</span>),</span><br><span class="line">         <span class="string">'key1'</span>:list(<span class="string">'aabba'</span>),</span><br><span class="line">         <span class="string">'key2'</span>:list(<span class="string">'xyyxy'</span>)&#125;)</span><br><span class="line">print(df1)</span><br><span class="line"><span class="comment"># 按key1分组，进行聚合计算</span></span><br><span class="line"><span class="comment"># 注意：当分组后进行数值计算时，不是数值类的列（即麻烦列）会被清除</span></span><br><span class="line">print(df1.groupby(<span class="string">'key1'</span>).sum())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只算data1</span></span><br><span class="line"><span class="comment"># print(df1['Data1'].groupby(df1['key1']).sum())</span></span><br><span class="line"><span class="comment"># print(df1.groupby('key1')['Data1'].sum())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用agg()函数做聚合运算</span></span><br><span class="line"><span class="comment"># print(df1.groupby('key1').agg('sum'))</span></span><br><span class="line"><span class="comment"># 可以同时做多个聚合运算</span></span><br><span class="line"><span class="comment"># print(df1.groupby('key1').agg(['sum','mean','std']))</span></span><br><span class="line"><span class="comment"># 可自定义函数，传入agg方法中 grouped.agg(func)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">peak_range</span><span class="params">(df)</span>:</span></span><br><span class="line">  <span class="string">"""</span></span><br><span class="line"><span class="string">   返回数值范围</span></span><br><span class="line"><span class="string"> """</span></span><br><span class="line">  <span class="keyword">return</span> df.max() - df.min()</span><br><span class="line"><span class="comment"># print(df1.groupby('key1').agg(peak_range))</span></span><br><span class="line"><span class="comment"># 同时应用多个聚合函数</span></span><br><span class="line"><span class="comment"># print(df1.groupby('key1').agg(['mean', 'std', 'count', peak_range])) # 默认列名为函数名</span></span><br><span class="line"><span class="comment"># print(df1.groupby('key1').agg(['mean', 'std', 'count', ('range',peak_range)])) # 通过元组提供新的列名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给每列作用不同的聚合函数</span></span><br><span class="line">dict_mapping = &#123;</span><br><span class="line">  <span class="string">'Data1'</span>:[<span class="string">'mean'</span>,<span class="string">'max'</span>],</span><br><span class="line">  <span class="string">'Data2'</span>:<span class="string">'sum'</span></span><br><span class="line">&#125;</span><br><span class="line">df1.groupby(<span class="string">'key1'</span>).agg(dict_mapping)</span><br></pre></td></tr></table></figure>

<p>拓展apply（）函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拓展apply函数</span></span><br><span class="line"><span class="comment"># apply函数是pandas里面所有函数中自由度最高的函数</span></span><br><span class="line">df1=pd.DataFrame(&#123;<span class="string">'sex'</span>:list(<span class="string">'FFMFMMF'</span>),<span class="string">'smoker'</span>:list(<span class="string">'YNYYNYY'</span>),<span class="string">'age'</span>:</span><br><span class="line">[<span class="number">21</span>,<span class="number">30</span>,<span class="number">17</span>,<span class="number">37</span>,<span class="number">40</span>,<span class="number">18</span>,<span class="number">26</span>],<span class="string">'weight'</span>:[<span class="number">120</span>,<span class="number">100</span>,<span class="number">132</span>,<span class="number">140</span>,<span class="number">94</span>,<span class="number">89</span>,<span class="number">123</span>]&#125;)</span><br><span class="line">print(df1)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bin_age</span><span class="params">(age)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> age &gt;=<span class="number">18</span>:</span><br><span class="line">    	<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  	<span class="keyword">else</span>:</span><br><span class="line">    	<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="comment"># 抽烟的年龄大于等18的</span></span><br><span class="line"><span class="comment"># print(df1['age'].apply(bin_age))</span></span><br><span class="line"><span class="comment"># df1['age'] = df1['age'].apply(bin_age)</span></span><br><span class="line"><span class="comment"># print(df1)</span></span><br><span class="line"><span class="comment"># 取出抽烟和不抽烟的体重前二</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(smoker,col,n=<span class="number">5</span>)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> smoker.sort_values(by=col)[-n:]</span><br><span class="line">df1.groupby(<span class="string">'smoker'</span>).apply(top,col=<span class="string">'weight'</span>,n=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Bang Li</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/06/24/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%EF%BC%886%EF%BC%89/">http://yoursite.com/2020/06/24/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%EF%BC%886%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/07/%E5%B0%8F%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%94%B5%E5%BD%B1%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"><img class="prev_cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">小案例：电影数据分析</div></div></a></div><div class="next-post pull_right"><a href="/2020/06/24/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%EF%BC%885%EF%BC%89/"><img class="next_cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">数据分析学习之路（5）</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Bang Li</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script></body></html>